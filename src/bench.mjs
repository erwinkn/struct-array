var ft=Object.defineProperty;var lt=(t,e)=>{for(var r in e)ft(t,r,{get:e[r],enumerable:!0})};var Z={type:"boolean",size:1};var M={type:"unsigned",size:4};var tt={type:"signed",size:2},F={type:"signed",size:4};var et={type:"float",size:4};function B(t){let e=t.type==="float"?"Float":t.type==="unsigned"?"Uint":"Int",r=t.size>4?"Big":"",n=t.size*8;return r+e+n}function L(t){let e=0,r={},n="",i="";for(let o of Object.keys(t)){let s=t[o];if(s.type==="boolean")i+=`this.$$view.setUint8(offset + ${e}, value.${o});`,n+=`${o}:!!this.$$view.getUint8(offset + ${e}),`,Object.defineProperty(r,o,{enumerable:!0,get:new Function(`return !!this.$$view.getUint8(this.$$offset + ${e});`),set:new Function("value",`this.$$view.setUint8(this.$$offset + ${e}, value);`)}),e+=1;else if(s.type==="unsigned"||s.type==="signed"||s.type==="float")i+=`this.$$view.set${B(s)}(offset + ${e}, value.${o});`,n+=`${o}:this.$$view.get${B(s)}(offset + ${e}),`,Object.defineProperty(r,o,{enumerable:!0,get:new Function(`return this.$$view.get${B(s)}(this.$$offset + ${e});`),set:new Function("value",`this.$$view.set${B(s)}(this.$$offset + ${e}, value);`)}),e+=s.size;else throw new Error("Unsupported data type")}r.$$schema=t,r.grow=function(o){if(this.length>o)throw new Error(`Cannot shrink capacity to ${o} when length is ${this.length}`);let s=new Uint8Array(this.$$view.buffer),c=new Uint8Array(o*this.structSize);c.set(s),this.$$view=new DataView(c.buffer),this.$$capacity=o},r.structSize=e,r.move=function(o){this.$$offset=o*this.structSize},r.next=function(){this.$$offset+=this.structSize},r.get=new Function("index",`const offset = index * this.structSize; return {${n}};`),r.set=new Function("index","value",`const offset = index * this.structSize; ${i}`),r.push=new Function("value",`if(this.length === this.$$capacity) {
			this.grow(2 * this.length);
		 }
		 const offset = this.length * this.structSize;
		 ${i}
		 this.length += 1;
		`),r.swap=function(o,s){let c=this.get(o),w=this.get(s);this.set(s,c),this.set(o,w)},r.pop=function(){this.length-=1},r.popValue=function(){return this.length-=1,this.get(this.length)};let u=new Function("capacity",`capacity = capacity || 12; this.$$offset = 0; this.length = 0; this.$$capacity = capacity;this.$$view = new DataView(new ArrayBuffer(capacity * ${e}));`);return u.prototype=r,u}var rt=(()=>{let t=Math.ceil;try{return Bun.nanoseconds(),{now:Bun.nanoseconds,diff:(e,r)=>e-r}}catch{}try{if(process.hrtime.bigint(),"Deno"in globalThis)throw 0;return{now:process.hrtime.bigint,diff:(e,r)=>Number(e-r)}}catch{}try{return Deno.core.opSync("op_bench_now"),{diff:(e,r)=>e-r,now:()=>Deno.core.opSync("op_bench_now")}}catch{}try{return Deno.core.opSync("op_now"),{diff:(e,r)=>e-r,now:()=>t(1e6*Deno.core.opSync("op_now"))}}catch{}try{return $.agent.monotonicNow(),{diff:(e,r)=>e-r,now:()=>t(1e6*$.agent.monotonicNow())}}catch{}return{diff:(e,r)=>e-r,now:()=>t(1e6*performance.now())}})(),nt=rt.now,b=rt.diff;var y=nt;function ot(t,e){return t>e?1:t<e?-1:0}function it(t,e,r,n,i,u,o){return{n:t,min:n,max:i,jit:u,p75:o[Math.ceil(t*(75/100))-1],p99:o[Math.ceil(t*(99/100))-1],avg:e?Math.ceil(r/t):r/t,p995:o[Math.ceil(t*(99.5/100))-1],p999:o[Math.ceil(t*(99.9/100))-1]}}async function C(t,e,r=!1){let n=0,i=0,u=0,o=1/0,s=-1/0,c=new Array,w=new Array(10);t:{let d=0,f=10;for(;f--;){let p=y(),m=e();if(w[d++]=b(y(),p),m instanceof Promise)return await m,T(t,e,r)}let h=0;f=4;let a=10*1e6;for(;0<a||0<f--;){let p=y();e();let m=b(y(),p);if(0>m){f++;continue}h++,u+=m,a-=m}u/=h}t:if(u>1e4){let d=10,f=t*1e6;for(;0<f||0<d--;){let h=y();e();let a=b(y(),h);if(0>a){d++;continue}n++,i+=a,f-=a,c.push(a),a<o&&(o=a),a>s&&(s=a)}}else{let d=10,f=t*1e6;if(r){let h=new Array(1e4);for(;0<f||0<d--;){let a=y();for(let m=0;m<1e4;m++)h[m]=e();let p=b(y(),a)/1e4;if(0>p){d++;continue}n++,i+=p,c.push(p),f-=p*1e4,p<o&&(o=p),p>s&&(s=p)}}else for(;0<f||0<d--;){let h=y();for(let p=0;p<1e4;p++)e();let a=b(y(),h)/1e4;if(0>a){d++;continue}n++,i+=a,c.push(a),f-=a*1e4,a<o&&(o=a),a>s&&(s=a)}}return c.sort(ot),it(n,u>1e4,i,o,s,w,c)}async function T(t,e,r=!1){let n=0,i=0,u=0,o=1/0,s=-1/0,c=new Array,w=new Array(10);t:{let d=0,f=10;for(;f--;){let p=y();await e(),w[d++]=b(y(),p)}let h=0;f=4;let a=10*1e6;for(;0<a||0<f--;){let p=y();await e();let m=b(y(),p);if(0>m){f++;continue}h++,u+=m,a-=m}u/=h}t:if(u>1e4){let d=10,f=t*1e6;for(;0<f||0<d--;){let h=y();await e();let a=b(y(),h);if(0>a){d++;continue}n++,i+=a,f-=a,c.push(a),a<o&&(o=a),a>s&&(s=a)}}else{let d=10,f=t*1e6;if(r){let h=new Array(1e4);for(;0<f||0<d--;){let a=y();for(let m=0;m<1e4;m++)h[m]=await e();let p=b(y(),a)/1e4;if(0>p){d++;continue}n++,i+=p,c.push(p),f-=p*1e4,p<o&&(o=p),p>s&&(s=p)}}else for(;0<f||0<d--;){let h=y();for(let p=0;p<1e4;p++)await e();let a=b(y(),h)/1e4;if(0>a){d++;continue}n++,i+=a,c.push(a),f-=a*1e4,a<o&&(o=a),a>s&&(s=a)}}return c.sort(ot),it(n,u>1e4,i,o,s,w,c)}var N={};lt(N,{bgBlack:()=>kt,bgBlue:()=>Ut,bgCyan:()=>Dt,bgGreen:()=>Ft,bgMagenta:()=>_t,bgRed:()=>zt,bgWhite:()=>Bt,bgYellow:()=>It,black:()=>xt,blue:()=>At,bold:()=>I,cyan:()=>U,dim:()=>mt,gray:()=>S,green:()=>$t,hidden:()=>bt,inverse:()=>wt,italic:()=>ht,magenta:()=>R,red:()=>W,reset:()=>dt,strikethrough:()=>St,underline:()=>gt,white:()=>vt,yellow:()=>J});function l(t,e){let r=new RegExp(`\\x1b\\[${e}m`,"g"),n=`\x1B[${t}m`,i=`\x1B[${e}m`;return function(u,o){return!u||o==null?o:n+(~(""+o).indexOf(i)?o.replace(r,i+n):o)+i}}var dt=l(0,0),I=l(1,22),mt=l(2,22),ht=l(3,23),gt=l(4,24),wt=l(7,27),bt=l(8,28),St=l(9,29),xt=l(30,39),W=l(31,39),$t=l(32,39),J=l(33,39),At=l(34,39),R=l(35,39),U=l(36,39),vt=l(37,39),S=l(90,39),kt=l(40,49),zt=l(41,49),Ft=l(42,49),It=l(43,49),Ut=l(44,49),_t=l(45,49),Dt=l(46,49),Bt=l(47,49);function k(t,e="en-us"){return t<1?`${Number((t*1e3).toFixed(2)).toLocaleString(e)} ps`:t<1e3?`${Number(t.toFixed(2)).toLocaleString(e)} ns`:t<1e6?`${Number((t/1e3).toFixed(2)).toLocaleString(e)} \xB5s`:t<1e9?`${Number((t/1e6).toFixed(2)).toLocaleString(e)} ms`:t<1e12?`${Number((t/1e9).toFixed(2)).toLocaleString(e)} s`:t<36e11?`${Number((t/6e10).toFixed(2)).toLocaleString(e)} m`:`${Number((t/36e11).toFixed(2)).toLocaleString(e)} h`}function st(t){let e=9;for(let r of t)e<r.length&&(e=r.length);return 2+e}function H({size:t,avg:e=!0,min_max:r=!0,percentiles:n=!0}){return"-".repeat(t+14*e+24*r)+(n?" "+"-".repeat(9+10+10):"")}function K(t,e,{size:r,avg:n=!0,colors:i=!0,min_max:u=!0,percentiles:o=!0}){return t.padEnd(r," ")+`${W(i,"error")}: ${e.message}${e.stack?`
`+S(i,e.stack):""}`}function at({size:t,avg:e=!0,min_max:r=!0,percentiles:n=!0}){return"benchmark".padEnd(t," ")+(e?"time (avg)".padStart(14," "):"")+(r?"(min \u2026 max)".padStart(24," "):"")+(n?` ${"p75".padStart(9," ")} ${"p99".padStart(9," ")} ${"p995".padStart(9," ")}`:"")}function G(t,e,{size:r,avg:n=!0,colors:i=!0,min_max:u=!0,percentiles:o=!0}){return t.padEnd(r," ")+(n?`${J(i,k(e.avg))}/iter`.padStart(14+10*i," "):"")+(u?`(${U(i,k(e.min))} \u2026 ${R(i,k(e.max))})`.padStart(24+2*10*i," "):"")+(o?` ${S(i,k(e.p75)).padStart(9+10*i," ")} ${S(i,k(e.p99)).padStart(9+10*i," ")} ${S(i,k(e.p995)).padStart(9+10*i," ")}`:"")}function Y(t,{colors:e=!0}={}){t=t.filter(n=>!n.error),t.sort((n,i)=>n.stats.avg-i.stats.avg);let r=t.find(n=>n.baseline)||t[0];return I(e,"summary")+(r.group==null||r.group.startsWith?.("$mitata_group")?"":S(e,` for ${r.group}`))+`
  ${I(e,U(e,r.name))}`+t.filter(n=>n!==r).map(n=>{let i=Number((1/r.stats.avg*n.stats.avg).toFixed(2)),u=Number((1/n.stats.avg*r.stats.avg).toFixed(2));return`
   ${N[1>i?"red":"green"](e,1<=i?i:u)}x ${1>i?"slower":"faster"} than ${I(e,U(e,n.name))}`}).join("")}var Nt=0,P=null,ct={},z=[],ut=new Set,q=(async()=>{}).constructor;function _(t,e){let r={summary:t.summary??!0,name:(typeof t=="string"?t:t.name)||`$mitata_group${++Nt}`};P=r.name,ut.add(r.name),ct[P]=r.summary,(e||t)(),P=null}function x(t,e){if([Function,q].includes(t.constructor)&&(e=t,t=e.name),![Function,q].includes(e.constructor))throw new TypeError(`expected function, got ${e.constructor.name}`);z.push({fn:e,name:t,group:P,time:500,warmup:!0,baseline:!1,async:q===e.constructor})}var V;try{if(V=console.log,typeof V!="function")throw 1}catch{V=print}function g(...t){V(...t)}function j(){return"Bun"in globalThis?"bun":"Deno"in globalThis?"deno":"process"in globalThis?"node":"navigator"in globalThis?"browser":"unknown"}function Pt(){return{unknown:()=>"",browser:()=>"",node:()=>process.version,deno:()=>Deno.version.deno,bun:()=>process.versions.bun}[j()]()}function Vt(){return{unknown:()=>"unknown",browser:()=>"unknown",deno:()=>Deno.build.target,bun:()=>`${process.arch}-${process.platform}`,node:()=>`${process.arch}-${process.platform}`}[j()]()}async function jt(){return await{unknown:()=>"unknown",browser:()=>"unknown",node:()=>import("os").then(t=>t.cpus()[0].model),bun:async()=>{try{if(process.platform==="linux"){let t=await import("fs"),e=new Uint8Array(64*1024),r=t.openSync("/proc/cpuinfo","r"),n=new TextDecoder().decode(e.subarray(0,t.readSync(r,e))).trim().split(`
`);t.closeSync(r);for(let i of n){let[u,o]=i.split(":");if(/model name|Hardware|Processor|^cpu model|chip type|^cpu type/.test(u))return o.trim()}}if(process.platform==="darwin"){let{ptr:t,dlopen:e,CString:r}=Bun.FFI,n=e("libc.dylib",{sysctlbyname:{args:["ptr","ptr","ptr","ptr","isize"],returns:"isize"}}).symbols.sysctlbyname,i=new Uint8Array(256),u=new BigInt64Array([256n]),o=new TextEncoder().encode("machdep.cpu.brand_string\0");if(Number(n(t(o),t(i),t(u),0,0))===-1)throw 0;return new r(t(i))}}catch{}return"unknown"},deno:async()=>{try{if(Deno.build.os==="darwin"){let t=Deno.run({stdin:"null",stderr:"null",stdout:"piped",cmd:["sysctl","-n","machdep.cpu.brand_string"]});return Deno.core.decode(await t.output()).trim()}if(Deno.build.os==="linux"){let t=new TextDecoder().decode(Deno.readFileSync("/proc/cpuinfo")).split(`
`);for(let e of t){let[r,n]=e.split(":");if(/model name|Hardware|Processor|^cpu model|chip type|^cpu type/.test(r))return n.trim()}}if(Deno.build.os==="windows"){let t=Deno.run({stdin:"null",stderr:"null",stdout:"piped",cmd:["wmic","cpu","get","name"]});return Deno.core.decode(await t.output()).split(`
`).at(-1).trim()}}catch{}return"unknown"}}[j()]()}async function pt(t={}){let e=t.colors??=!0,r=t.collect||!1,n=!!t.json||t.json===0;t.size=st(z.map(u=>u.name));let i={benchmarks:z,cpu:await jt(),runtime:`${`${j()} ${Pt()}`.trim()} (${Vt()})`};n||(g(S(e,`cpu: ${i.cpu}`)),g(S(e,`runtime: ${i.runtime}`)),g(""),g(at(t)),g(H(t)));t:{let u=!1,o=!1;for(let s of z)if(!s.group){s.baseline&&(o=!0),u=!0;try{s.stats=s.async?await T(s.time,s.fn,r):await C(s.time,s.fn,r),n||g(G(s.name,s.stats,t))}catch(c){s.error={stack:c.stack,message:c.message},n||g(K(s.name,c,t))}}o&&!n&&g(`
`+Y(z.filter(s=>s.group===null),t));for(let s of ut){n||(u&&g(""),s.startsWith("$mitata_group")||g(`\u2022 ${s}`),(u||!s.startsWith("$mitata_group"))&&g(S(e,H(t)))),u=!0;for(let c of z)if(s===c.group)try{c.stats=c.async?await T(c.time,c.fn,r):await C(c.time,c.fn,r),n||g(G(c.name,c.stats,t))}catch(w){c.error={stack:w.stack,message:w.message},n||g(K(c.name,w,t))}ct[s]&&!n&&g(`
`+Y(z.filter(c=>s===c.group),t))}return n&&g(JSON.stringify(i,null,typeof t.json!="number"?0:t.json)),i}}var A=3e5,Q=L({a:F,b:F,c:F,d:F}),v,E;function Et(){v=new Q(A);for(let t=0;t<A;t++)v.push({a:t,b:t+1,c:t+2,d:t+3})}function Ot(){v=new Q(A);for(let t=0;t<A;t++)v.set(t,{a:t,b:t+1,c:t+2,d:t+3})}function Mt(){E=[];for(let t=0;t<A;t++)E.push({a:t,b:t+1,c:t+2,d:t+3})}function Lt(){let t=0;for(let e=0;e<A;e++){let r=v.get(e);t+=r.b-r.a+r.d-r.c}return t}function Ct(){let t=0;for(let e=0;e<A;e++){let r=E[e];t+=r.b-r.a+r.d-r.c}return t}function Wt(){let t=0;v.move(0);for(let e=0;e<A;e++)t+=v.a,v.move(e);return t}function Jt(){let t=0;for(let e=0;e<A;e++)t+=E[e].a;return t}var O=3e5,Rt=L({a:tt,b:Z,c:et,d:M,e:M}),X=new Rt,D=[];for(let t=0;t<O;t++){let e={a:t,b:!0,c:t-1,d:3,e:4};X.push(e),D.push(e)}function Ht(){for(let t=0;t<O-1;t++)X.swap(t,t+1)}function Kt(){for(let t=0;t<O-1;t++){let e=D[t];D[t]=D[t+1],D[t+1]=e}}_("Array creation",()=>{x("Array",Mt),x("StructArray",Et),x("StructArray with set",Ot)});_("Array read (full)",()=>{x("StructArray",Lt),x("Array",Ct)});_("Array read (1 property)",()=>{x("StructArray",Wt),x("Array",Jt)});_(`Swap ${O} structs of size ${X.structSize}`,()=>{x("StructArray",Ht),x("Array",Kt)});await pt();
